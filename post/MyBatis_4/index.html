<html>
  <head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MyBatis_4	多表查询  | 清汤牛肉锅</title>
<link rel="shortcut icon" href="https://ArtZoick.github.io//favicon.ico?v=1562208403931">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://ArtZoick.github.io//styles/main.css">

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-143265163-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-143265163-1');
</script>


  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://ArtZoick.github.io/">
  <img class="avatar" src="https://ArtZoick.github.io//images/avatar.png?v=1562208403931" alt="">
  </a>
  <h1 class="site-title">
    清汤牛肉锅
  </h1>
  <p class="site-description">
    温故而知新
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu">
          归档
        </a>
      
    
      
        <a href="/tags" class="menu">
          标签
        </a>
      
    
      
        <a href="/post/about" class="menu">
          关于
        </a>
      
    
      
        <a href="/post/beef" class="menu">
          牛肉锅
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>


        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              MyBatis_4	多表查询 
            </h2>
            <div class="post-info">
              <time class="post-time">
                · 2019-07-03 ·
              </time>
              
                <a href="https://ArtZoick.github.io//tag/framework" class="post-tag">
                  # 框架
                </a>
              
                <a href="https://ArtZoick.github.io//tag/MyBatis" class="post-tag">
                  # MyBatis
                </a>
              
            </div>
            
            <div class="post-content">
              <h2 id="当有多个mapperxml的时候">当有多个mapper.xml的时候</h2>
<h3 id="错误写法">错误写法</h3>
<pre><code class="language-xml">&lt;mappers&gt;
        &lt;mapper resource=&quot;com/daniel/dao/IUserDao.xml&quot;/&gt;
        &lt;mapper resource=&quot;com/daniel/dao/IAccountDao.xml&quot;/&gt;
 &lt;/mappers&gt;
</code></pre>
<h3 id="正确写法">正确写法</h3>
<pre><code class="language-xml"> &lt;!--指定映射配置文件的位置，映射配置文件指的是每个dao配置的文件--&gt;
    &lt;mappers&gt;
        &lt;package name=&quot;com.daniel.dao&quot;&gt;&lt;/package&gt;
    &lt;/mappers&gt;
</code></pre>
<p>大致的demo的框架</p>
<p><img src="https://ArtZoick.github.io//post-images/mybatis/5.png" alt=""></p>
<h2 id="一对一的关系映射">一对一的关系映射</h2>
<p>查询所有账户的时候同时获得当前账户的所有信息（多表查询常用方法）</p>
<h4 id="sql-语句">sql 语句</h4>
<p>sql 语句查询所有账户的时候同时获得当前账户的所有信息 findAll</p>
<pre><code class="language-sql">select u.*,a.id as aid,a.uid,a.money from account a ,user u where u.id=a.uid;
</code></pre>
<p>sql 语句查询所有账户的时候同时获得当前账户的所地址和姓名</p>
<pre><code class="language-sql"> select a.*,u.username,u.address from account a ,user u where u.id=a.uid;
</code></pre>
<h3 id="1从表实体应该包含一个主表实体的对象引用">1.	从表实体应该包含一个主表实体的对象引用</h3>
<p>在Account类中</p>
<pre><code class="language-java">//从表实体应该包含一个主表实体的对象引用
    private User user;

    public User getUser() {
        return user;
    }

    public void setUser(User user) {
        this.user = user;
    }

</code></pre>
<h3 id="2accountdao的接口中">2.AccountDao的接口中</h3>
<pre><code class="language-java"> //查询所有账户
    List&lt;Account&gt; findAll();
</code></pre>
<h3 id="3accountdao的mapper中">3.AccountDao的mapper中</h3>
<pre><code class="language-xml">&lt;!--定义封装account和user的resultMap--&gt;
    &lt;resultMap id=&quot;accountUserMap&quot; type=&quot;Account&quot;&gt;
        &lt;id property=&quot;id&quot; column=&quot;aid&quot;&gt;&lt;/id&gt;

        &lt;result property=&quot;uid&quot; column=&quot;uid&quot;&gt;&lt;/result&gt;
        &lt;result property=&quot;money&quot; column=&quot;money&quot;&gt;&lt;/result&gt;

        &lt;!--一对一的关系映射，account配置封装user的内容 column中指名从表的外键 property=&quot;user&quot;指的是单个实体类的引用 --&gt;
        &lt;association property=&quot;user&quot; column=&quot;uid&quot; javaType=&quot;User&quot;&gt;
            &lt;id property=&quot;id&quot; column=&quot;id&quot;&gt;&lt;/id&gt;
            &lt;result property=&quot;username&quot; column=&quot;username&quot;&gt;&lt;/result&gt;
            &lt;result property=&quot;sex&quot; column=&quot;sex&quot;&gt;&lt;/result&gt;
            &lt;result property=&quot;address&quot; column=&quot;address&quot;&gt;&lt;/result&gt;
            &lt;result property=&quot;birthday&quot; column=&quot;birthday&quot;&gt;&lt;/result&gt;
        &lt;/association&gt;
    &lt;/resultMap&gt;

    &lt;select id=&quot;findAll&quot; resultMap=&quot;accountUserMap&quot;&gt;
        select u.*,a.id as aid,a.uid,a.money from account a ,user u where u.id=a.uid;
    &lt;/select&gt;
</code></pre>
<p>注意事项中的javaType=“User” 一定要指名主体表的实体类名然后column中指名从表的外键！！</p>
<pre><code class="language-xml">&lt;association property=&quot;user&quot; column=&quot;uid&quot; javaType=&quot;User&quot;&gt;
</code></pre>
<h3 id="4accountdao的测试类中">4.AccountDao的测试类中</h3>
<pre><code class="language-java"> @Test
    public void findAll(){
        List&lt;Account&gt; accounts = accoutDao.findAll();
        for (Account account:
             accounts) {
            System.out.println(&quot;每一个account的信息&quot;);
            System.out.println(account);
            System.out.println(account.getUser());
        }
    }
</code></pre>
<h3 id="5成功运行实现上述功能">5.成功运行（实现上述功能）</h3>
<p><img src="https://ArtZoick.github.io//post-images/mybatis/6.png" alt=""></p>
<h3 id="第二种方法是创建一个accountuser类">第二种方法是创建一个AccountUser类</h3>
<p>由于不常用就不细叙了</p>
<h2 id="一对多的关系映射">一对多的关系映射</h2>
<p>主表实体中应该包含从表实体的集合引用</p>
<h4 id="sql语句">sql语句</h4>
<pre><code class="language-sql">select * from user u left outer join account a on [u.id](http://u.id/) = a.uid
</code></pre>
<p>left join（左连接）是left outer join的简写，返回左表中所有记录和右表中连接字段相等的记录，即返回的记录数和左表的记录数一样</p>
<p><img src="https://ArtZoick.github.io//post-images/mybatis/7.png" alt=""></p>
<h3 id="1主表实体中应该包含从表实体的集合引用">1.主表实体中应该包含从表实体的集合引用</h3>
<p>User类中</p>
<pre><code class="language-java"> //主表实体中应该包含从表实体的集合引用
    private List&lt;Account&gt; accounts;
</code></pre>
<h3 id="2userdao的接口中">2.UserDao的接口中</h3>
<pre><code class="language-java">//  查询所有用户
 List&lt;User&gt; findAll();
</code></pre>
<h3 id="3userdao的mapper中">3.UserDao的mapper中</h3>
<pre><code class="language-xml"> &lt;!--定义封装user和account的resultMap type主表实体类--&gt;
    &lt;resultMap id=&quot;userAccountMap&quot; type=&quot;User&quot;&gt;

        &lt;id property=&quot;id&quot; column=&quot;id&quot;&gt;&lt;/id&gt;
        &lt;result property=&quot;username&quot; column=&quot;username&quot;&gt;&lt;/result&gt;
        &lt;result property=&quot;sex&quot; column=&quot;sex&quot;&gt;&lt;/result&gt;
        &lt;result property=&quot;address&quot; column=&quot;address&quot;&gt;&lt;/result&gt;
        &lt;result property=&quot;birthday&quot; column=&quot;birthday&quot;&gt;&lt;/result&gt;

        &lt;!--一对多的关系映射，配置user封装accounts的内容--&gt;
        &lt;!--其中的property指的是从表的集合引用 ofType从表实体类--&gt;
        &lt;collection property=&quot;accounts&quot; ofType=&quot;Account&quot;&gt;
            &lt;id property=&quot;id&quot; column=&quot;aid&quot;&gt;&lt;/id&gt;
            &lt;result property=&quot;uid&quot; column=&quot;uid&quot;&gt;&lt;/result&gt;
            &lt;result property=&quot;money&quot; column=&quot;money&quot;&gt;&lt;/result&gt;
        &lt;/collection&gt;
    &lt;/resultMap&gt;

    &lt;!--配置查询所有  其中id不能乱写必须是dao接口中的方法  --&gt;
    &lt;select id=&quot;findAll&quot; resultMap=&quot;userAccountMap&quot;&gt;
       select * from user u left outer join account a on u.id = a.uid
    &lt;/select&gt;
</code></pre>
<h3 id="4userdao的测试类中">4.UserDao的测试类中</h3>
<pre><code class="language-java">//查询所有（一个用户下的账号信息）
    @Test
    public  void findAll( ) throws Exception {

        List&lt;User&gt; users = userDao.findAll();
        for (User user:users
             ) {
            System.out.println(&quot;每个用户的信息&quot;);
            System.out.println(user);
            System.out.println(user.getAccounts());
        }

    }
</code></pre>
<h3 id="5成功运行实现上述功能-2">5.成功运行（实现上述功能）</h3>
<p><img src="https://ArtZoick.github.io//post-images/mybatis/8.png" alt=""></p>
<h2 id="多对多的关系映射">多对多的关系映射</h2>
<h4 id="需要实现的功能">需要实现的功能</h4>
<p><img src="https://ArtZoick.github.io//post-images/mybatis/9.png" alt=""></p>
<h4 id="sql语句多表外链接查询语句">sql语句(多表外链接查询语句)</h4>
<p>select u.*, r.id as rid,r.role_name,r.role_desc from role r<br>
left outer join user_role ur on r.id = ur.rid<br>
left outer join user u on u.id=ur.uid</p>
<p>注意其中每行末尾的空格<br>
分析从role表中为准的左表( role r)中所有记录和右表（user_role ur）中连接字段相等的记录，即返回的记录数和左表的记录数一样(而且还可以输出不关联的行)再以此合并的表为基础( role r user_role ur )中连接和右表( user u )中连接字段相等的记录</p>
<p>多表外链接查询语句</p>
<p>use+数据库</p>
<p>select+查询列名</p>
<p>from+表1</p>
<p>left/right (outer) join +表2</p>
<p>on 表2的列=表1的列</p>
<p><img src="https://ArtZoick.github.io//post-images/mybatis/10.png" alt=""></p>
<h3 id="1一个实体表中包含另一个实体表的集合引用">1.一个实体表中包含另一个实体表的集合引用</h3>
<p>由于是多对多的关系所有不分从表和主表</p>
<pre><code class="language-java">//多对多的关系映射：一个角色可以赋予多个用户
    private List&lt;User&gt; users;

    public List&lt;User&gt; getUsers() {
        return users;
    }

    public void setUsers(List&lt;User&gt; users) {
        this.users = users;
    }

</code></pre>
<h3 id="2roledao的接口中定义该方法">2.RoleDao的接口中定义该方法</h3>
<pre><code class="language-java">List&lt;Role&gt; findAll();
</code></pre>
<h3 id="3roledao的mapper中">3.RoleDao的mapper中</h3>
<pre><code class="language-xml"> &lt;resultMap id=&quot;roleMap&quot; type=&quot;role&quot;&gt;
        &lt;id property=&quot;roleId&quot; column=&quot;rid&quot;&gt;&lt;/id&gt;
        &lt;result property=&quot;roleName&quot; column=&quot;role_name&quot;&gt;&lt;/result&gt;
        &lt;result property=&quot;roleDesc&quot; column=&quot;role_desc&quot;&gt;&lt;/result&gt;
        &lt;collection property=&quot;users&quot; ofType=&quot;user&quot;&gt;
            &lt;id property=&quot;id&quot; column=&quot;id&quot;&gt;&lt;/id&gt;
            &lt;result property=&quot;username&quot; column=&quot;username&quot;&gt;&lt;/result&gt;
            &lt;result property=&quot;address&quot; column=&quot;address&quot;&gt;&lt;/result&gt;
            &lt;result property=&quot;sex&quot; column=&quot;sex&quot;&gt;&lt;/result&gt;
            &lt;result property=&quot;birthday&quot; column=&quot;birthday&quot;&gt;&lt;/result&gt;
        &lt;/collection&gt;
    &lt;/resultMap&gt;


    &lt;select id=&quot;findAll&quot; resultMap=&quot;roleMap&quot;&gt;
       select u.*,r.id as rid,r.role_name,r.role_desc from role r
        left outer join user_role ur on r.id = ur.rid
        left outer join user u on u.id=ur.uid
    &lt;/select&gt;
</code></pre>
<h3 id="4roledao的测试类中">4.RoleDao的测试类中</h3>
<pre><code class="language-java">@Test
    public void findAll(){
        List&lt;Role&gt; roles  = roleDao.findAll();
        for (Role role:roles
             ) {
            System.out.println(&quot;=====每个角色的信息=====&quot;);
            System.out.println(role);
            System.out.println(role.getUsers());
        }
    }
</code></pre>
<h3 id="5成功运行实现上述功能-3">5.成功运行（实现上述功能）</h3>
<h3 id="同理可得功能二">===同理可得功能二===</h3>
<h4 id="sql语句-2">sql语句</h4>
<pre><code class="language-sql">select u.*, r.id as rid,r.role_name,r.role_desc from user u
left outer join user_role ur on u.id = ur.uid
left outer join role r on r.id=ur.rid
</code></pre>
<h3 id="6一个实体表中包含另一个实体表的集合引用">6.一个实体表中包含另一个实体表的集合引用</h3>
<pre><code class="language-java">private List&lt;Role&gt; roles;

public List&lt;Role&gt; getRoles() {
        return roles;
}

public void setRoles(List&lt;Role&gt; roles) {
        this.roles = roles;
}

</code></pre>
<h3 id="7userdao的接口中定义该方法">7.UserDao的接口中定义该方法</h3>
<pre><code class="language-java">  //  查询所有
    List&lt;User&gt; findAll();
</code></pre>
<h3 id="8userdao的mapper中">8.UserDao的mapper中</h3>
<pre><code class="language-xml"> &lt;resultMap id=&quot;userMap&quot; type=&quot;user&quot;&gt;

        &lt;id property=&quot;id&quot; column=&quot;id&quot;&gt;&lt;/id&gt;
        &lt;result property=&quot;username&quot; column=&quot;username&quot;&gt;&lt;/result&gt;
        &lt;result property=&quot;address&quot; column=&quot;address&quot;&gt;&lt;/result&gt;
        &lt;result property=&quot;sex&quot; column=&quot;sex&quot;&gt;&lt;/result&gt;
        &lt;result property=&quot;birthday&quot; column=&quot;birthday&quot;&gt;&lt;/result&gt;


        &lt;collection property=&quot;roles&quot; ofType=&quot;role&quot;&gt;
            &lt;id property=&quot;roleId&quot; column=&quot;rid&quot;&gt;&lt;/id&gt;
            &lt;result property=&quot;roleName&quot; column=&quot;role_name&quot;&gt;&lt;/result&gt;
            &lt;result property=&quot;roleDesc&quot; column=&quot;role_desc&quot;&gt;&lt;/result&gt;
        &lt;/collection&gt;
    &lt;/resultMap&gt;


    &lt;select id=&quot;findAll&quot; resultMap=&quot;userMap&quot;&gt;
       select u.*,r.id as rid,r.role_name,r.role_desc from user u

      left outer join user_role ur on u.id = ur.uid

       left outer join role r on r.id=ur.rid
    &lt;/select&gt;

</code></pre>
<h3 id="9userdao的测试类中">9.UserDao的测试类中</h3>
<pre><code> @Test
    public  void findAll( ) throws Exception {

        List&lt;User&gt; users = userDao.findAll();
        for (User user:users
             ) {
            System.out.println(&quot;====每个用户的信息====&quot;);
            System.out.println(user);
            System.out.println(user.getRoles());
        }

    }
</code></pre>
<h3 id="10成功运行实现上述功能">10.成功运行（实现上述功能）</h3>
<hr>
<h1 id="jndi">JNDI</h1>
<p>JNDI是 Java 命名与目录接口（Java Naming and Directory Interface），在J2EE规范中是重要的规范之一。</p>
<p><img src="https://ArtZoick.github.io//post-images/mybatis/11.png" alt=""></p>
<hr>

            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="https://ArtZoick.github.io//post/MyBatis_3">
              <h3 class="post-title">
                MyBatis_3	动态SQL
              </h3>
            </a>
          </div>
        

        
          
            <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: 'a2471d09bddb5be481ee',
    clientSecret: '05d427fb27f873cfabace27b9f042f2c7f23000f',
    repo: 'ArtZoick.github.io',
    owner: 'ArtZoick',
    admin: ['ArtZoick'],
    id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

          

          
        

        <div class="site-footer">
  <a href="https://zhidao.baidu.com/question/1867120235416383707.html" target="_blank" onclick="alert('盲生，你发现了华点！');">学习强国</a> | 
  <a class="rss" href="https://ArtZoick.github.io//atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

      </div>
    </div>
  </body>
</html>
